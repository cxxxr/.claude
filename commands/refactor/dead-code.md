---
description: デッドコード（未使用コード）を検出して削除
argument-hint: "[path]"
---

指定されたパス（デフォルト: プロジェクト全体）でデッドコードを検出し、削除してください。

**重要**: 見かけ上の未使用と真の未使用を区別すること。安全な削除が目的であり、単なるコード量削減ではない。

## 検出対象

| カテゴリ | 説明 |
|---------|------|
| **未使用の変数・定数** | 宣言されているが参照されていない |
| **未使用の関数・メソッド** | 定義されているが呼び出されていない |
| **未使用のインポート** | importされているが使用されていない |
| **未使用の型定義** | 定義されているが参照されていない |
| **到達不能コード** | return/throw後のコード、常にfalseの条件分岐内 |
| **コメントアウトされたコード** | 古いコードがコメントとして残っている |

## デッドコード判定フィルター (Dead Code Gate)

各候補に対し、以下の8項目をYes/Noで評価し表形式で提示:

| # | 評価項目 | 判定 | 根拠 |
|---|---------|------|------|
| 1 | **静的参照なし**: コード内に直接的な参照が存在しないか |  |  |
| 2 | **動的参照なし**: 文字列ベースの呼び出し、リフレクション、eval等で使用されていないか |  |  |
| 3 | **外部参照なし**: 公開API、ライブラリとしてエクスポートされていないか |  |  |
| 4 | **設定参照なし**: 設定ファイル、環境変数、DI設定から参照されていないか |  |  |
| 5 | **テンプレート参照なし**: HTML/JSXテンプレート、文字列テンプレートから参照されていないか |  |  |
| 6 | **フレームワーク規約外**: フレームワークが暗黙的に呼び出す規約（ライフサイクルフック等）に該当しないか |  |  |
| 7 | **将来使用予定なし**: TODO/FIXME/計画的なコメントで将来使用が示唆されていないか |  |  |
| 8 | **テスト専用でない**: テストコードからのみ参照されるヘルパーではないか |  |  |

### スコア判定

- **8/8 Yes** → 即座に削除可能
- **6〜7 Yes** → 削除推奨（確認後に削除）
- **5以下 Yes** → 削除保留（追加調査が必要）

## 安全弁ルール

以下に該当する場合は削除を中止:

| ルール | 条件 |
|--------|------|
| **公開APIルール** | `export`されており、パッケージ外から使用される可能性がある場合は中止 |
| **エントリーポイントルール** | main関数、イベントハンドラ、ルート定義など起点となるコードは中止 |
| **プラグインルール** | プラグイン機構で動的にロードされる可能性がある場合は中止 |
| **シリアライズルール** | JSON/YAML等からデシリアライズされるクラス・型は中止 |
| **デコレータ/アノテーションルール** | メタデータとして参照される可能性がある場合は中止 |

## 出力フォーマット

各候補について以下を提示:

### 1. 評価テーブル
デッドコード判定フィルター表（8項目）と合計スコア

### 2. 候補の詳細
- ファイルパスと行番号
- コードの種類（関数/変数/インポート等）
- コードスニペット（該当部分を引用）

### 3. 削除の影響範囲
- 削除対象のコード量（行数）
- 関連して削除可能になるコード（連鎖的なデッドコード）
- 依存関係の変化

### 4. 削除方法
- 擬似diffで削除内容を示す
- 段階的に削除する場合はその順序

### 5. 検証計画
- 削除後に実行すべきテスト
- ビルド/リント確認項目
- 動作確認が必要な機能

### 6. リスクと撤退計画
- 想定される問題パターン
- git revertによる復元手順

## 不確実性の扱い

- 評価項目が「不明」の場合はNoとして扱う（不確実なら削除を避ける）
- 動的言語（JavaScript/Python等）では特に動的参照に注意
- 判断に迷う場合は削除保留としてユーザーに判断を委ねる

## 手順

1. 対象パスのコードを分析し、デッドコード候補をリストアップ
2. 各候補にデッドコード判定フィルターを適用
3. スコアと安全弁ルールに基づき削除可否を判定
4. 削除対象について上記フォーマットで計画を提示
5. ユーザーの承認後、デッドコードを削除
6. ビルド/リント/テストが通ることを確認

対象パス: $ARGUMENTS
